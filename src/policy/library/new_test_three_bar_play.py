"""
NewTestThreeBarPlayScanner Strategy
Generated by scripts/create_strategy.py
"""

from src.policy.scanners import Scanner, ScanResult
from src.features.state import MarketState
from src.features.pipeline import FeatureBundle
from typing import Dict, Any

class NewTestThreeBarPlayScanner(Scanner):
    """
    TODO: Add description of your strategy here.
    """

    @property
    def scanner_id(self) -> str:
        return "new_test_three_bar_play"

    def scan(self, state: MarketState, features: FeatureBundle) -> ScanResult:
        """
        Check for entry conditions on every bar.
        
        Available data:
        - state.timestamp, state.current_price, state.last_close
        - features.indicators (RSI, EMA, etc.)
        """
        
        # Custom Logic for Three Bar Play
        # Check if current price > prev close (green bar)
        # We can get prev close from ohlcv_1m if available
        
        triggered = False
        context = {}
        
        last_close = state.current_price # Default if no history
        if len(state.ohlcv_1m) > 0:
            last_close = state.ohlcv_1m[-1][3] # Close is index 3
            
        if state.current_price > last_close:
            triggered = True
            context = {
                "direction": "LONG",
                "reason": "Three Bar Play pattern",
                "entry_price": state.current_price
            }

        return ScanResult(
            scanner_id=self.scanner_id,
            triggered=triggered,
            context=context,
            score=1.0 if triggered else 0.0
        )
