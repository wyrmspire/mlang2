"""
NewTestEmaCrossScanner Strategy
Generated by scripts/create_strategy.py
"""

from src.policy.scanners import Scanner, ScanResult
from src.features.state import MarketState
from src.features.pipeline import FeatureBundle
from typing import Dict, Any

class NewTestEmaCrossScanner(Scanner):
    """
    TODO: Add description of your strategy here.
    """

    @property
    def scanner_id(self) -> str:
        return "new_test_ema_cross"

    def scan(self, state: MarketState, features: FeatureBundle) -> ScanResult:
        """
        Check for entry conditions on every bar.
        
        Available data:
        - state.timestamp, state.current_price, state.last_close
        - features.indicators (RSI, EMA, etc.)
        """
        
        # Custom Logic for EMA Cross - ATR Sample
        ema_fast = features.indicators.ema_5m_20
        ema_slow = features.indicators.ema_5m_200
        
        triggered = False
        context = {}
        
        if ema_fast > ema_slow and ema_fast > 0:
            triggered = True
            context = {
                "direction": "LONG",
                "reason": "EMA 20 > EMA 50",
                "entry_price": state.current_price
            }    

        return ScanResult(
            scanner_id=self.scanner_id,
            triggered=triggered,
            context=context,
            score=1.0 if triggered else 0.0
        )
